<html>
<head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />

    <title>Typeahead</title>
    <link rel="stylesheet" href="/js/select2/select2.css" type="text/css" />
</head>
<body>
<form action="" method="get" accept-charset="utf-8">
    I want to <input type="hidden" name="action" id="action" placeholder="Hike, eat, drink, etc." value="" />
    at <input type="hidden" name="location" id="location" value="" />
</form>
    
<script src="http://ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>
<script type="text/javascript" src="/js/select2/select2.js"></script>
<script type="text/javascript">

var unlock = unlock || {
    current_category: null,
};

$('#action').select2({
    ajax: {
        url: '/data/activities.json',
        dataType: 'json',
        results: function(data, page) {
            return data;
        }
    },
    formatResult: function(object) {
        return object.value;
    },
    formatSelection: function(object) {
        return object.value;
    }
}).on('change', function(e) {
    unlock.current_category = e.added.id;
});

$('#location').select2({
    ajax: {
        url: function(term, page, context) {
            return [
                '/the/json/endpoint?category_id=',
                unlock.current_category,
                '&term=',
                term
            ].join('');
        },
        dataType: 'json',
        results: function(data, page) {
            return data;
        }
    },
    formatResult: function(object) {
        return object.value;
    },
    formatSelection: function(object) {
        return object.value;
    }
});

</script>
</body>
</html>
