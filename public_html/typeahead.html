<html>
<head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />

    <title>Typeahead</title>
</head>
<body>
<form action="" method="get" accept-charset="utf-8">
    I want to <input type="text" name="action" id="action" placeholder="Hike, eat, drink, etc." value="" />
    at <input type="text" name="location" id="location" value="" />
</form>
    
<script src="http://ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>
<script type="text/javascript" src="/js/typeahead.min.js"></script>
<script type="text/javascript">

window.localStorage.clear();

var unlock = unlock || {
    current_action: null,
};

$('#action').typeahead({
    name: 'actions',
    prefetch: '/data/activities.json',
    template: function(result) {
        return result.value;
    },
}).on('typeahead:selected typeahead:autocompleted', function(e, TypeaheadEvent) {
    console.log(TypeaheadEvent.id);
    unlock.current_action = TypeaheadEvent.id;
});

$('#location').typeahead([
  {
    name: 'counties',
    prefetch: '/data/counties.json',
    template: function(result) {
        return result.value;
    }
  },
  {
    name: 'attractions',
    prefetch: '/data/attractions.json',
    template: function(result) {
        return result.value;
    }
  },
  {
    name: 'remote',
    remote: {
        url: '/the/json/endpoint',
        replace: function(url, uriEncodedQuery) {
            var endpoint = [url, '?action=', unlock.current_action, '&query=', uriEncodedQuery].join('');
            return endpoint;
        }
    },
    template: function(result) {
        return result.value;
    }
  }
]).on('typeahead:selected typeahead:autocompleted', function(e, TypeaheadEvent) {
    console.log(TypeaheadEvent);
});
    
</script>
</body>
</html>
